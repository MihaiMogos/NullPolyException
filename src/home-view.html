<!--
@license
Copyright (c) 2016 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->

<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="shared-styles.html">

<dom-module id="home-view" >
  <template>
    <style include="shared-styles">
      :host {
        display: block;

        padding: 10px;
      }
      :host {
            --my-custom-color: red;
            --paper-tab-ink: var(--my-custom-color);

            /* custom CSS property */
            --paper-tabs-selection-bar-color: #00897B;

            /* custom CSS mixin */
            --paper-tabs: {
                color: var(--default-primary-color); /* variable defined in default-theme.html */
                font-size: 20px;
            }
        }

    .picker#heading.heading-content.pg-chooseDate {
      color: #ffffff;
      background: #00897B!important;
    }

      carousel-slide {
          background: #00897B!important;
          color: #fff;
          font-size: 36px;
          line-height: 100px;
          margin: 1px;
          padding: 2%;
          position: relative;
          text-align: center;
      }

      paper-date-picker {
        --default-primary-color : #00897B;
      }

      paper-tab {
        --paper-tabs: #00897B;
      }
    </style>

      <iron-signals on-iron-signal-addeduserevent="_handleSelectionChanged"></iron-signals>

      <grid-element start>
      <grid-col s="5">
        <div class="card">
          <paper-tabs selected="0">
            <paper-tab on-tap="_changeTab"> <span style="color:#000000!important;">Today</span></paper-tab>
            <paper-tab on-tap="_changeTab"> <span style="color:#000000!important;">This week</span></paper-tab>
          </paper-tabs>
          <div hidden$="{{!showDay}}">
          <div class="card" >
            <paper-datatable-card id="datatableCard" page-size="10"  selected-ids="{{selectedIds}}">
              <paper-datatable id="datatable" selected-items="{{selectedItems}}" on-row-tap="rowTapped" data="{{eventsonpage}}">
                <div no-results>
                  There are no events in the calendar.
                </div>
                <paper-datatable-column header="Icon" property="picture"  style="min-width: 41px" >
                    <div style="height: 42px;width: 42px;">
                      {{value.picture}}
                    </div>
                </paper-datatable-column>
                <paper-datatable-column header="Hour" property="hour" type="String"  align="center" style="min-width: 40px" >
                    <span>{{value.hour}}</span>
                </paper-datatable-column>
                <paper-datatable-column header="Name" property="name" type="String"  style="min-width: 160px">
                    <span>{{value.name}}</span>
                </paper-datatable-column>
                <paper-datatable-column header="Date" property="date" type="String"  style="min-width: 40px" inactive>
                    <span>{{value.date}}</span>
                </paper-datatable-column>
                <paper-datatable-column header="Description" property="description" type="String">
                    <span>{{value.description}}</span>
                </paper-datatable-column>
                <paper-datatable-column header="Location" property="location" type="String">
                    <span>{{value.location}}</span>
                </paper-datatable-column>
              </paper-datatable>
            </paper-datatable-card>
          </div>
        </div>
        <div hidden$="{{showDay}}">
          <div class="card">
            <paper-datatable-card id="datatableCard" page-size="10"  selected-ids="{{selectedIds}}">
              <paper-datatable id="datatableweek" selected-items="{{selectedItems}}" on-row-tap="rowTapped" data="{{weekEvents}}">
                <div no-results>
                  There are no events in the calendar.
                </div>
                <paper-datatable-column header="Icon" property="picture"  style="min-width: 41px" >
                    <div style="height: 42px;width: 42px;">
                      {{value.picture}}
                    </div>
                </paper-datatable-column>
                <paper-datatable-column header="Date" property="date" type="String"  align="center" style="min-width: 40px" >
                    <span>{{value.date}}</span>
                </paper-datatable-column>
                <paper-datatable-column header="Hour" property="hour" type="String"  align="center" style="min-width: 40px" >
                    <span>{{value.hour}}</span>
                </paper-datatable-column>
                <paper-datatable-column header="Name" property="name" type="String"  style="min-width: 160px">
                    <span>{{value.name}}</span>
                </paper-datatable-column>
                <paper-datatable-column header="Date" property="date" type="String"  style="min-width: 40px" inactive>
                    <span>{{value.date}}</span>
                </paper-datatable-column>
                <paper-datatable-column header="Description" property="description" type="String"  style="min-width: 320px" >
                    <span>{{value.description}}</span>
                </paper-datatable-column>
                <paper-datatable-column header="Location" property="location" type="String"  style="min-width: 320px" >
                    <span>{{value.location}}</span>
                </paper-datatable-column>
              </paper-datatable>
            </paper-datatable-card>
          </div>
        </div>
        </div>
      </grid-col>
      <grid-col s="1">
           <div class="card">
              <!--<app-datepicker id="picker" date="[[currentDate]]" on-click="_handleSelectionChanged" view="vertical" ><app-datepicker>-->
              <paper-date-picker id="picker" date="[[currentDate]]" on-click="_handleSelectionChanged" narrow></paper-date-picker>
          </div>
          <div class="card">
            <header><center>Interesting this week</center></header>
            <hr>
            <br>
            <simple-carousel style="margin-top: -25px;" transition-style="linear" infinite-loop="true" auto="true" transition-time="5000" transition-duration="500">
              <carousel-slide>
                <span ><img src='http://lorempixel.com/277/277/business/' height='72px' width='72px' style="margin-top: 35px;"/> DevoxxMA <l2t-star-rating stars="5"</span>
              </carousel-slide>
              <carousel-slide>
                <span><img src='http://lorempixel.com/277/277/business/' height='72px' width='72px' style="margin-top: 35px;"/> DevoxxPL <l2t-star-rating stars="5"</span>
              </carousel-slide>
              <carousel-slide>
                <span><img src='http://lorempixel.com/277/277/business/' height='72px' width='72px' style="margin-top: 35px;"/> DevoxxBUH <l2t-star-rating stars="5"</span>
              </carousel-slide>         
            </simple-carousel>
          </div>
      </grid-col>
    </grid-element>
  </template>

  <script>
    Polymer({
      is: 'home-view',
      properties: {
          currentDate: {
            type: Date,
            notify:true,
            value: new Date()
          },
          showDay: {
            type: Boolean,
            value: true,
            notify:true
          },
          weekEvents: {
            type: Array,
            notify: true,
            value: []
          }
      },
      ready: function() {
        console.log("HOME DATA RECEIVED: " + this.events[0].name);
        console.log(this.currentDate);
        console.log(this.eventsonpage);
        // //console.log(this.events);
        // console.log(this.$.datatable.data);
        // this.$.datatable.data = this.eventsOnPage;
        // //this.$.datatable.reload();
      },
      _handleSelectionChanged: function(e) {
        console.log("APELATA!!");
        console.log(this.$.picker);
        var now = new Date(this.$.picker.date).toISOString().slice(0, 10);
        console.log(now);

        var selectedDate = new Date(this.$.picker.date).toISOString().slice(0, 10);
        this.set('eventsOnPage',[]);
        this.notifyPath('eventsOnPage',this.eventsOnPage);
        this.set('weekEvents',[]);
        this.notifyPath('weekEvents',this.weekEvents);

        for(var i=0; i < this.events.length; i++) {
          if(this.events[i].date === selectedDate) {
            this.push('eventsOnPage', this.events[i]);
          }
        }
        this.$.datatable.data = this.eventsOnPage;
        this.$.datatable.reload();
        console.log(this.eventsOnPage);

        now = new Date(this.$.picker.date);
        var monday = this.getMonday(now);
        console.log("monday: " + monday);
        var weekDays = [];
        var myDate = new Date(monday);
        for(var j=0; j < 7; j++) {
          weekDays.push(myDate.toISOString().slice(0, 10));
          //add a day to the date
          myDate.setDate(myDate.getDate() + 1);
        }


        console.log(weekDays);
        for(var k=0; k<this.events.length;k++) {
          if(this.isInArray(this.events[k].date,weekDays)) {
            this.push('weekEvents',this.events[k]);
          }
        }
        console.log(this.weekEvents);
        
      },
      // ON ITEM TAP: TODO
      rowTapped: function(e) {
          console.log(e.detail);
          this.fire('iron-signal', {name: 'eventinfopaper', data: e.detail});
      },
      _changeTab:function() {
        this.showDay = !this.showDay;
        this._handleSelectionChanged();
      },
      getMonday: function(d) {
          d = new Date(d);
          var day = d.getDay(),
          diff = d.getDate() - day + (day == 0 ? -6:1); // adjust when day is sunday
          return new Date(d.setDate(diff));
      },
      isInArray: function(value,array) {
          return array.indexOf(value) > -1;
      }
    });
  </script>
</dom-module>
